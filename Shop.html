<!DOCTYPE html>
<html lang="az">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shop</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      overflow-x: hidden;
    }

    .top-banner {
      background: linear-gradient(to right, #e74c3c, #c0392b);
      color: white;
      text-align: center;
      padding: 8px 0;
      font-size: 13px;
    }

    .top-banner a {
      color: white;
      text-decoration: underline;
      margin-left: 5px;
    }

    header {
      background: white;
      padding: 15px 50px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      color: #000;
    }

    nav {
      display: flex;
      gap: 30px;
      align-items: center;
    }

    nav a {
      text-decoration: none;
      color: #333;
      font-size: 14px;
    }

    .shop-btn {
      background: #e74c3c;
      color: white;
      padding: 8px 20px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      border-radius: 4px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .search-bar {
      padding: 8px 15px;
      border: 1px solid #ddd;
      width: 200px;
      font-size: 13px;
      border-radius: 4px;
    }

    .cart-btn {
      background-color: white;
      border: 1px solid #ddd;
      padding: 8px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }

    .cart-btn:hover {
      background-color: #f5f5f5;
    }

    .signup-btn {
      background: #e74c3c;
      color: white;
      padding: 8px 20px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      border-radius: 4px;
      transition: background 0.3s ease;
    }

    .signup-btn:hover {
      background: #c0392b;
    }

    .user-icon {
      background: white;
      border: 1px solid #ddd;
      cursor: pointer;
      font-size: 18px;
      display: none;
      align-items: center;
      gap: 5px;
      padding: 8px 15px;
      color: black;
      text-decoration: none;
      border-radius: 4px;
    }

    .main-wrapper {
      margin-top: 20px;
      padding: 20px;
    }

    .top-bar {
      max-width: 1200px;
      margin: 0 auto 20px auto;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .search-box {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 200px;
      font-size: 14px;
    }

    .all-products-btn {
      background-color: #e53935;
      color: white;
      border: none;
      padding: 8px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }

    .sort-dropdown {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .main-content {
      display: flex;
      gap: 30px;
    }

    .sidebar {
      width: 200px;
      flex-shrink: 0;
    }

    .sidebar h3 {
      font-size: 18px;
      margin-bottom: 15px;
      font-weight: bold;
    }

    .category-list {
      list-style: none;
      margin-bottom: 30px;
    }

    .category-list li {
      padding: 8px 0;
      cursor: pointer;
      font-size: 14px;
      transition: color 0.3s;
    }

    .category-list li:hover {
      color: #e53935;
    }

    .category-list li.active {
      color: #e53935;
      font-weight: 500;
    }

    .rate-section h3 {
      font-size: 18px;
      margin-bottom: 15px;
      font-weight: bold;
    }

    .rate-option {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.3s;
      padding: 5px;
      border-radius: 4px;
    }

    .rate-option:hover {
      background-color: #fff3e0;
    }

    .rate-option.active {
      background-color: #ffe0e0;
      font-weight: 500;
    }

    .rate-option.active .stars {
      color: #e53935;
      font-size: 18px;
    }

    .stars {
      color: #ffc107;
      font-size: 16px;
      transition: all 0.3s;
    }

    .products-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 25px;
    }

    .product-card {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      background-color: white;
      transition: box-shadow 0.3s, transform 0.3s;
      cursor: pointer;
      position: relative;
    }

    .product-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-5px);
    }

    .product-card img {
      width: 100%;
      height: 200px;
      object-fit: contain;
      background-color: #f5f5f5;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .product-name {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 10px;
      min-height: 40px;
    }

    .product-price {
      color: #e53935;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .product-rating {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-bottom: 15px;
      font-size: 14px;
    }

    .rating-stars {
      color: #ffc107;
    }

    .rating-count {
      color: #999;
    }

    .add-to-cart-btn {
      width: 100%;
      background-color: #333;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      transition: background-color 0.3s;
    }

    .add-to-cart-btn:hover {
      background-color: #555;
    }

      footer {
        background: #e74c3c;
        color: white;
        padding: 60px 80px 30px 80px;
        font-family: "Poppins", sans-serif;
      }

      .footer-content {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 40px;
        margin-bottom: 40px;
      }

      .footer-column h3 {
        font-size: 18px;
        margin-bottom: 20px;
        font-weight: 600;
      }

      .footer-column p,
      .footer-column a {
        color: #fff;
        text-decoration: none;
        display: block;
        margin-bottom: 10px;
        font-size: 13px;
        line-height: 1.7;
      }

      .footer-subscribe input {
        width: 80%;
        padding: 10px;
        border: 1px solid white;
        background: transparent;
        color: white;
        font-size: 13px;
        outline: none;
      }

      .footer-subscribe input::placeholder {
        color: #fff;
      }

      .subscribe-btn {
        color: #ffffff;
        border: none;
        padding: 10px;
        margin-left: -40px;
        cursor: pointer;
        font-size: 12px;
        font-weight: bold;
        background: #e74c3c;
      }

      .qr-code {
        width: 80px;
        height: 80px;
        background: white;
        margin-bottom: 10px;
        border-radius: 5px;
      }

      .app-buttons img {
        width: 120px;
        display: block;
        margin-bottom: 8px;
      }

      .social-icons {
        display: flex;
        gap: 15px;
        margin-top: 15px;
      }

      .social-icons i {
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s;
      }

      .social-icons i:hover {
        opacity: 0.7;
      }

      .footer-bottom {
        text-align: center;
        padding-top: 25px;
        border-top: 1px solid rgba(255, 255, 255, 0.3);
        font-size: 13px;
        opacity: 0.9;
      }

      @media (max-width: 900px) {
        .story-section {
          grid-template-columns: 1fr;
        }

        .team-section {
          grid-template-columns: repeat(2, 1fr);
        }

        .footer-content {
          grid-template-columns: repeat(2, 1fr);
          gap: 30px;
        }
      }

      @media (max-width: 600px) {
        header {
          padding: 15px 20px;
          flex-wrap: wrap;
        }

        nav {
          order: 3;
          width: 100%;
          margin-top: 15px;
          justify-content: center;
        }

        .team-section {
          grid-template-columns: 1fr;
        }

        .footer-content {
          grid-template-columns: 1fr;
          text-align: center;
        }

        .footer-subscribe input {
          width: 100%;
          margin-bottom: 10px;
        }

        .subscribe-btn {
          width: 100%;
          margin-left: 0;
        }
      }
  </style>
</head>

<body>
  <div class="top-banner">
    Summer Sale For All Swim Suits And Free Express Delivery - OFF 50%!
    <a href="#">ShopNow</a>
  </div>

  <header>
    <div class="logo">E-commerce</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="Contact.html">Contact</a>
      <a href="about.html">About</a>
      <a href="signup.html">Sign Up</a>
      <button class="shop-btn" onclick="window.location.href='shop.html'">
        Shop
      </button>
    </nav>
    <div class="header-right">
      <input type="text" class="search-bar" placeholder="What are you looking for?" />
      <i class="fas fa-search"></i>
      <button class="cart-btn">üõí</button>
      <a href="account.html" class="user-icon">
        üë§ <span class="username-text">username</span>
      </a>
      <button class="signup-btn">Log In</button>
    </div>
  </header>

  <div class="main-wrapper">
    <div class="top-bar">
      <input type="text" class="search-box" placeholder="search" id="productSearch" />
      <button class="all-products-btn" id="allProductsBtn">
        All products
      </button>
      <select class="sort-dropdown" id="sortDropdown">
        <option value="">Sort by</option>
        <option value="price-low">Price: Low to High</option>
        <option value="price-high">Price: High to Low</option>
        <option value="rating-high">Rating: High to Low</option>
      </select>
    </div>

    <div class="container">
      <div class="main-content">
        <aside class="sidebar">
          <div class="category-section">
            <h3>Category</h3>
            <ul class="category-list" id="categoryList">

            </ul>
          </div>

          <div class="rate-section">
            <h3>Rating</h3>
            <div class="rate-option" data-rating="5">
              <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
            </div>
            <div class="rate-option" data-rating="4">
              <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ</span>
            </div>
            <div class="rate-option" data-rating="3">
              <span class="stars">‚òÖ‚òÖ‚òÖ</span>
            </div>
            <div class="rate-option" data-rating="2">
              <span class="stars">‚òÖ‚òÖ</span>
            </div>
            <div class="rate-option" data-rating="1">
              <span class="stars">‚òÖ</span>
            </div>
          </div>
        </aside>

        <div class="products-grid" id="productsGrid"></div>
      </div>
    </div>
  </div>

    <footer>
      <div class="footer-content">
        <div class="footer-column footer-subscribe">
          <h3>Exclusive</h3>
          <p>Subscribe</p>
          <p>Get 10% off your first order</p>
          <div class="email-input-wrapper">
            <input type="email" placeholder="Enter your email" />
            <button class="subscribe-btn">‚Üí</button>
          </div>
        </div>

        <div class="footer-column">
          <h3>Support</h3>
          <p>111 Bijoy sarani, Dhaka,<br />DH 1515, Bangladesh.</p>
          <p>exclusive@gmail.com</p>
          <p>+88015-88888-9999</p>
        </div>

        <div class="footer-column">
          <h3>Account</h3>
          <a href="#">My Account</a>
          <a href="#">Login / Register</a>
          <a href="#">Cart</a>
          <a href="#">Wishlist</a>
          <a href="#">Shop</a>
        </div>

        <div class="footer-column">
          <h3>Quick Link</h3>
          <a href="#">Privacy Policy</a>
          <a href="#">Terms Of Use</a>
          <a href="#">FAQ</a>
          <a href="#">Contact</a>
        </div>

        <div class="footer-column">
          <h3>Download App</h3>
          <p style="font-size: 11px; opacity: 0.8">
            Save $3 with App New User Only
          </p>
          <div class="qr-and-apps">
            <img src="img/qrcode.svg" alt="QR Code" class="qr-code" />
            <div class="app-buttons">
              <img
                src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg"
                alt="Google Play"
              />
              <img
                src="https://upload.wikimedia.org/wikipedia/commons/3/3c/Download_on_the_App_Store_Badge.svg"
                alt="App Store"
              />
            </div>
          </div>
          <div class="social-icons">
            <i class="fab fa-facebook-f"></i>
            <i class="fab fa-twitter"></i>
            <i class="fab fa-instagram"></i>
            <i class="fab fa-linkedin-in"></i>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        ¬© Copyright Rimel 2022. All right reserved
      </div>
    </footer>
  <script src="auth.js"></script>

  <script>
    // Elements - HTML-d…ôki d√ºzg√ºn class/id-l…ôrl…ô
    const categoryList = document.querySelector(".category-list");
    const searchInput = document.getElementById("productSearch");
    const sortSelect = document.getElementById("sortDropdown");
    const productsGrid = document.getElementById("productsGrid");
    const allProductsBtn = document.getElementById("allProductsBtn");
    const rateOptions = document.querySelectorAll(".rate-option");

    let products = [];
    let allCategories = [];
    let activeCategory = "";
    let activeRating = "";
    let activeSearch = "";
    let activeSort = "";
    let page = 0;
    let size = 100;

    // ‚≠ê CATEGORY LOAD
    async function loadCategories() {
      try {
        const res = await fetch("http://195.26.245.5:9505/api/categories");
        const data = await res.json();
        allCategories = data;

        categoryList.innerHTML = "";
        data.forEach(cat => {
          const li = document.createElement("li");
          li.textContent = cat.name;
          li.dataset.categoryId = cat.id;
          li.addEventListener("click", () => {
            document.querySelectorAll(".category-list li").forEach(item => item.classList.remove("active"));
            li.classList.add("active");
            activeCategory = cat.id;
            fetchProductsFromAPI();
          });
          categoryList.appendChild(li);
        });

      } catch (err) {
        console.error("Category API failed:", err);
      }
    }

    // ‚≠ê RATING FILTER
    rateOptions.forEach(option => {
      option.addEventListener("click", () => {
        // ∆èg…ôr eyni rating-…ô klikl…ônirs…ô, filtri sƒ±fƒ±rla
        if (option.classList.contains("active")) {
          option.classList.remove("active");
          activeRating = "";
        } else {
          document.querySelectorAll(".rate-option").forEach(o => o.classList.remove("active"));
          option.classList.add("active");
          activeRating = option.dataset.rating;
        }
        fetchProductsFromAPI();
      });
    });

    // ‚≠ê ALL PRODUCTS BUTTON
    allProductsBtn.addEventListener("click", () => {
      activeCategory = "";
      activeRating = "";
      activeSearch = "";
      searchInput.value = "";
      document.querySelectorAll(".category-list li").forEach(item => item.classList.remove("active"));
      document.querySelectorAll(".rate-option").forEach(o => o.classList.remove("active"));
      fetchProductsFromAPI();
    });

    // ‚≠ê FILTER API FUNCTION
    async function fetchProductsFromAPI() {
      const tokenData = localStorage.getItem("token");
      const token = tokenData?.includes("{") ? JSON.parse(tokenData).token : tokenData;

      let url = "http://195.26.245.5:9505/api/products/filter?"
        + `page=${page}&size=${size}`
        + (activeCategory ? `&categoryId=${activeCategory}` : "")
        + (activeRating ? `&rating=${activeRating}` : "")
        + (activeSearch ? `&search=${activeSearch}` : "")
        + (activeSort ? `&sortBy=${activeSort}` : "");

      try {
        const res = await fetch(url, {
          headers: token ? { "Authorization": `Bearer ${token}` } : {}
        });

        if (!res.ok) throw new Error("API returned " + res.status);

        const data = await res.json();
        products = data.content || [];

        localStorage.setItem("allProducts", JSON.stringify(products));
        renderProducts();

      } catch (err) {
        console.warn("API error ‚Üí fallback aktivdir.", err);
        products = fallbackProducts;
        renderProducts();
      }
    }

    // ‚≠ê PRODUCT CARD RENDER
    function renderProducts() {
      productsGrid.innerHTML = "";

      if (!products.length) {
        productsGrid.innerHTML = `<p style="color: #e53935; text-align: center; width: 100%;">No products found.</p>`;
        return;
      }

      products.forEach(p => {
        const stars = "‚òÖ".repeat(Math.round(p.averageRating || 0))
          + "‚òÜ".repeat(5 - Math.round(p.averageRating || 0));

        const card = document.createElement("div");
        card.className = "product-card";
        card.innerHTML = `
          <img src="${p.imageUrl}" alt="${p.brand}">
          <div class="product-name">${p.brand} ${p.model || ""}</div>
          <div class="product-price">${p.price.toFixed(2)} AZN</div>
          <div class="product-rating">
            <span class="rating-stars">${stars}</span>
            <span class="rating-count">(${p.averageRating || 0})</span>
          </div>
          <button class="add-to-cart-btn" onclick="addToCart(${p.id})">Add to Cart</button>
        `;
        
        card.addEventListener("click", (e) => {
          if (!e.target.classList.contains("add-to-cart-btn")) {
            viewDetails(p.id);
          }
        });

        productsGrid.appendChild(card);
      });
    }

    // ‚≠ê VIEW DETAILS
    function viewDetails(id) {
      window.location.href = `ProductPage.html?id=${id}`;
    }

    // ‚≠ê ADD TO CART
    function addToCart(id) {
      event.stopPropagation();
      const product = products.find(p => p.id === id);
      if (!product) return alert("Product not found!");

      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      const exists = cart.find(item => item.id === id);

      if (exists) exists.quantity += 1;
      else cart.push({ ...product, quantity: 1 });

      localStorage.setItem("cart", JSON.stringify(cart));
      alert(product.brand + " added to cart!");
    }

    // ‚≠ê SEARCH
    searchInput.addEventListener("input", e => {
      activeSearch = e.target.value.trim().toLowerCase();
      fetchProductsFromAPI();
    });

    // ‚≠ê SORT
    sortSelect.addEventListener("change", e => {
      const value = e.target.value;
      
      if (value === "price-low") {
        products.sort((a, b) => a.price - b.price);
      } else if (value === "price-high") {
        products.sort((a, b) => b.price - a.price);
      } else if (value === "rating-high") {
        products.sort((a, b) => b.averageRating - a.averageRating);
      }
      
      renderProducts();
    });

    // ‚≠ê INIT
    loadCategories().then(fetchProductsFromAPI);
  </script>

</body>

</html>